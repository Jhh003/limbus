<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API æµ‹è¯•</title>
    <style>
        body {
            font-family: monospace;
            padding: 20px;
            background: #1a1a1a;
            color: #fff;
        }
        .test-section {
            margin: 20px 0;
            padding: 15px;
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 5px;
        }
        button {
            padding: 10px 20px;
            margin: 5px;
            cursor: pointer;
            background: #4CAF50;
            color: white;
            border: none;
            border-radius: 4px;
        }
        button:hover {
            background: #45a049;
        }
        pre {
            background: #000;
            padding: 15px;
            overflow-x: auto;
            border-radius: 4px;
            max-height: 400px;
            overflow-y: auto;
        }
        .error {
            color: #f44336;
        }
        .success {
            color: #4CAF50;
        }
    </style>
</head>
<body>
    <h1>ğŸ” API è°ƒè¯•å·¥å…·</h1>
    
    <div class="test-section">
        <h2>æµ‹è¯•1: è·å–æ‰€æœ‰æ’è¡Œæ¦œæ•°æ®ï¼ˆä¸ç­›é€‰ï¼‰</h2>
        <button onclick="testGetAll()">æ‰§è¡Œæµ‹è¯•</button>
        <pre id="result1">ç­‰å¾…æµ‹è¯•...</pre>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•1.5: æ¨¡æ‹Ÿå‰ç«¯çš„å®é™…è¯·æ±‚</h2>
        <button onclick="testRealRequest()">æ‰§è¡Œæµ‹è¯•</button>
        <pre id="result1_5">ç­‰å¾…æµ‹è¯•...</pre>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•2: è·å–å¾…å®¡æ ¸æ•°æ®</h2>
        <button onclick="testGetPending()">æ‰§è¡Œæµ‹è¯•</button>
        <pre id="result2">ç­‰å¾…æµ‹è¯•...</pre>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•3: æµ‹è¯•æ’è¡Œæ¦œé¡µé¢æ˜¯å¦èƒ½æ­£å¸¸åŠ è½½</h2>
        <button onclick="window.open('global-ranking', '_blank')">æ‰“å¼€æ’è¡Œæ¦œé¡µé¢</button>
        <p>æ‰“å¼€åæŒ‰F12ï¼Œåœ¨Consoleä¸­è¾“å…¥ï¼š</p>
        <pre>globalRankingController.rankings  // æŸ¥çœ‹åŠ è½½çš„æ•°æ®
globalRankingController.filters    // æŸ¥çœ‹å½“å‰ç­›é€‰æ¡ä»¶</pre>
    </div>

    <div class="test-section">
        <h2>æµ‹è¯•4: æŸ¥çœ‹æ•°æ®åº“åŸå§‹æ•°æ®ï¼ˆéœ€è¦ç›´æ¥è®¿é—®æœåŠ¡å™¨ï¼‰</h2>
        <p>SSH åˆ°æœåŠ¡å™¨æ‰§è¡Œï¼š</p>
        <pre>cat /www/wwwroot/limbus/server/database/rankings.json</pre>
    </div>

    <script>
        const API_BASE = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000/api' 
            : 'http://101.35.90.43/api';

        async function testGetAll() {
            const resultEl = document.getElementById('result1');
            resultEl.innerHTML = 'ğŸ”„ è¯·æ±‚ä¸­...';
            
            try {
                const response = await fetch(`${API_BASE}/rankings/list?page=1&limit=100`);
                const data = await response.json();
                
                resultEl.innerHTML = `<div class="success">âœ… è¯·æ±‚æˆåŠŸ</div>\n` + 
                    `<strong>è¿”å›æ•°æ®ï¼š</strong>\n` +
                    JSON.stringify(data, null, 2) + '\n\n' +
                    `<strong>è®°å½•æ€»æ•°ï¼š</strong> ${data.data?.records?.length || 0}\n` +
                    `<strong>çŠ¶æ€ç»Ÿè®¡ï¼š</strong>\n` +
                    JSON.stringify(
                        data.data?.records?.reduce((acc, r) => {
                            acc[r.status] = (acc[r.status] || 0) + 1;
                            return acc;
                        }, {}),
                        null,
                        2
                    );
            } catch (error) {
                resultEl.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥</div>\n${error.message}\n${error.stack}`;
            }
        }

        async function testRealRequest() {
            const resultEl = document.getElementById('result1_5');
            resultEl.innerHTML = 'ğŸ”„ æ¨¡æ‹Ÿå‰ç«¯å®é™…è¯·æ±‚...';
            
            try {
                // å®Œå…¨æ¨¡æ‹Ÿå‰ç«¯çš„è¯·æ±‚
                const params = new URLSearchParams({
                    page: 1,
                    limit: 20,
                    sortBy: 'time',
                    status: 'verified'  // å‰ç«¯ä¼ çš„è¿™ä¸ªå‚æ•°
                });
                
                const url = `${API_BASE}/rankings/list?${params}`;
                resultEl.innerHTML = `ğŸ”„ è¯·æ±‚URL: ${url}\n\n`;
                
                const response = await fetch(url);
                const data = await response.json();
                
                resultEl.innerHTML += `<div class="success">âœ… è¯·æ±‚æˆåŠŸ</div>\n` + 
                    `<strong>å®Œæ•´è¿”å›ï¼š</strong>\n` +
                    JSON.stringify(data, null, 2);
            } catch (error) {
                resultEl.innerHTML += `<div class="error">âŒ è¯·æ±‚å¤±è´¥</div>\n${error.message}`;
            }
        }

        async function testGetPending() {
            const resultEl = document.getElementById('result2');
            resultEl.innerHTML = 'ğŸ”„ è¯·æ±‚ä¸­...ï¼ˆéœ€è¦ç®¡ç†å‘˜Tokenï¼‰';
            
            try {
                const token = localStorage.getItem('admin_token');
                if (!token) {
                    resultEl.innerHTML = '<div class="error">âŒ æœªæ‰¾åˆ°ç®¡ç†å‘˜Tokenï¼Œè¯·å…ˆç™»å½•ç®¡ç†åå°</div>';
                    return;
                }

                const response = await fetch(`${API_BASE}/rankings/pending`, {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });
                const data = await response.json();
                
                resultEl.innerHTML = `<div class="success">âœ… è¯·æ±‚æˆåŠŸ</div>\n` + 
                    `<strong>å¾…å®¡æ ¸è®°å½•ï¼š</strong>\n` +
                    JSON.stringify(data, null, 2);
            } catch (error) {
                resultEl.innerHTML = `<div class="error">âŒ è¯·æ±‚å¤±è´¥</div>\n${error.message}`;
            }
        }
    </script>
</body>
</html>
